/*! Ideal Postcodes jQuery Plugin - v0.1.0 - 2013-08-25
* https://github.com/ideal-postcodes/jquery.postcodes
* Copyright (c) 2013 Christopher Blanchard; Licensed MIT */
!function(a){"use strict";var b={api_key:"",address_line_one:"#address_line_one",address_line_two:"#address_line_two",address_line_three:"#address_line_three",post_town_line:"#post_town_line",postcode_line:"#postcode_line",api_endpoint:"https://api.ideal-postcodes.co.uk/v1/postcodes/",$input:"",input_label:"Please enter your postcode",input_muted_style:"color:#CBCBCB;",input_class:"",input_id:"idpc_input",$button:"",button_id:"idpc_button",button_label:"Find my Address",button_class:"",dropdown_id:"idpc_dropdown",dropdown_select_message:"Please select your address",dropdown_class:"",$error_message:"",error_message_id:"idpc_error_message",error_message_invalid_postcode:"Please check your postcode, it seems to be incorrect",error_message_not_found:"Your postcode could not be found. Please type in your address",error_message_default:"Sorry, we weren't able to get the address you were looking for. Please type your address manually",error_message_class:"",last_lookup:"",disable_interval:1e3,debug_mode:!1},c={init:function(d,e){c.$context=d,a.extend(c,b),e&&a.extend(c,e),c.setup()},setup:function(){c.$input=a("<input />",{type:"text",id:c.input_id,value:c.input_label,"class":c.input_class}).val(c.input_label).attr("style",c.input_muted_style).focus(function(){c.$input.removeAttr("style").val("")}).blur(function(){c.$input.val()||(c.$input.val(c.input_label),c.$input.attr("style",c.input_muted_style))}).submit(function(){return!1}).appendTo(c.$context),c.$button=a("<button />",{html:c.button_label,id:c.button_id,"class":c.button_class}).submit(function(){return!1}).click(function(){var a=c.$input.val();return c.last_lookup!==a&&(c.disable_lookup_button(),c.clear_existing_fields(),c.lookupPostcode(a)),!1}).appendTo(c.$context)},lookupPostcode:function(b){if(c.valid_postcode(b)){var d=function(b){c.handle_api_success(b),a.event.trigger("completedJsonp")},e=function(){c.show_error("Unable to connect to server"),a.event.trigger("completedJsonp")};a.lookupPostcode(b,c.api_key,d,e)}else c.show_error(c.error_message_invalid_postcode)},disable_lookup_button:function(a){c.$button.prop("disabled",!0).html(a||"Looking up postcode...")},enable_lookup_button:function(){setTimeout(function(){c.$button.prop("disabled",!1).html(c.button_label)},c.disable_interval)},valid_postcode:function(a){var b=/^[a-zA-Z0-9]{1,4}\s?\d[a-zA-Z]{2}$/;return!!a.match(b)},handle_api_success:function(a){c.response_code=a.code,c.response_message=a.message,c.result=a.result,2e3===c.response_code?(c.last_lookup=c.$input.val(),c.show_dropdown(c.result).appendTo(c.$context),c.enable_lookup_button()):c.handle_api_error()},handle_api_error:function(){4040===c.response_code?c.show_error(c.error_message_not_found):c.debug_mode?c.show_error("("+c.response_code+") "+c.response_message):c.show_error(c.error_message_default),c.enable_lookup_button()},clear_existing_fields:function(){c.$dropdown&&c.$dropdown.length&&c.$dropdown.remove(),c.$error_message&&c.$error_message.length&&c.$error_message.remove(),a(c.address_line_one).val(""),a(c.address_line_two).val(""),a(c.address_line_three).val(""),a(c.post_town_line).val(""),a(c.line).val("")},show_dropdown:function(b){var d=b.length,e=a("<select />",{id:c.dropdown_id,"class":c.dropdown_class});a("<option />",{value:"ideal",text:c.dropdown_select_message}).appendTo(e);for(var f=0;d>f;f+=1)a("<option />",{value:f,text:b[f].line_1+" "+b[f].line_2}).appendTo(e);return c.link_to_fields(e),c.$dropdown=e,e},link_to_fields:function(b){var d=c.result;return b.change(function(){var b=a(this).val();b>=0&&(a(c.address_line_one).val(d[b].line_1),a(c.address_line_two).val(d[b].line_2),a(c.address_line_three).val(d[b].line_3),a(c.post_town_line).val(d[b].post_town),a(c.postcode_line).val(d[b].postcode))})},show_error:function(b){c.enable_lookup_button(),c.$error_message=a("<p />",{html:b,id:c.error_message_id,"class":c.error_message_class}).appendTo(c.$context)}};a.fn.idealPostcodes=function(a){return c.init(this,a),this},a.lookupPostcode=function(d,e,f,g){var h=c.api_endpoint||b.api_endpoint,i=h+d+"?api_key="+e,j={url:i,dataType:"jsonp",timeout:5e3,success:f};g&&(j.error=g),a.ajax(j)},a.fn.idealPostcodes.defaults=b}(jQuery);