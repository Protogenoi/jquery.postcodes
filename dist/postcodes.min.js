/*! Ideal Postcodes jQuery Plugin - v1.2.1 - 2014-06-13
* https://github.com/ideal-postcodes/jquery.postcodes
* Copyright (c) 2014 Ideal Postcodes; Licensed MIT */
!function(a){"use strict";function b(b){this.config={},a.extend(this,e),b&&a.extend(this,b);var c={};for(var d in this.output_fields)void 0!==this.output_fields[d]&&(c[d]=a(this.output_fields[d]));this.$output_fields=c}var c,d=[],e={api_key:"",output_fields:{line_1:"#line_1",line_2:"#line_2",line_3:"#line_3",post_town:"#post_town",postcode:"#postcode",postcode_inward:void 0,postcode_outward:void 0,udprn:void 0,dependant_locality:void 0,double_dependant_locality:void 0,thoroughfare:void 0,dependant_thoroughfare:void 0,building_number:void 0,building_name:void 0,sub_building_name:void 0,po_box:void 0,department_name:void 0,organisation_name:void 0,postcode_type:void 0,su_organisation_indicator:void 0,delivery_point_suffix:void 0},api_endpoint:"https://api.ideal-postcodes.co.uk/v1",$input:void 0,input_label:"Please enter your postcode",input_muted_style:"color:#CBCBCB;",input_class:"",input_id:"idpc_input",$button:void 0,button_id:"idpc_button",button_label:"Find my Address",button_class:"",button_disabled_message:"Looking up postcode...",$dropdown:void 0,dropdown_id:"idpc_dropdown",dropdown_select_message:"Please select your address",dropdown_class:"",$error_message:void 0,error_message_id:"idpc_error_message",error_message_invalid_postcode:"Please check your postcode, it seems to be incorrect",error_message_not_found:"Your postcode could not be found. Please type in your address",error_message_default:"Sorry, we weren't able to get the address you were looking for. Please type your address manually",error_message_class:"",last_lookup:"",disable_interval:1e3,debug_mode:!1,onLookupSuccess:void 0,onLookupError:void 0,onAddressSelected:void 0};b.prototype.setupPostcodeInput=function(b){var c=this;this.$context=b,this.$input=a("<input />",{type:"text",id:this.input_id,value:this.input_label,"class":this.input_class}).val(this.input_label).attr("style",this.input_muted_style).focus(function(){c.$input.removeAttr("style").val("")}).blur(function(){c.$input.val()||(c.$input.val(c.input_label),c.$input.attr("style",c.input_muted_style))}).submit(function(){return!1}).keypress(function(a){13===a.which&&c.$button.trigger("click")}).appendTo(this.$context),this.$button=a("<button />",{html:this.button_label,id:this.button_id,"class":this.button_class}).attr("type","button").attr("onclick","return false;").submit(function(){return!1}).click(function(){var a=c.$input.val();return c.last_lookup!==a&&(c.last_lookup=a,c.disableLookup(),c.clearAll(),c.lookupPostcode(a)),!1}).appendTo(this.$context)},b.prototype.disableLookup=function(a){a=a||this.button_disabled_message,this.$button.prop("disabled",!0).html(a)},b.prototype.enableLookup=function(){var a=this;0===a.disable_interval?a.$button.prop("disabled",!1).html(a.button_label):setTimeout(function(){a.$button.prop("disabled",!1).html(a.button_label)},a.disable_interval)},b.prototype.clearAll=function(){this.setDropDown(),this.setErrorMessage(),this.setAddressFields()},b.prototype.removeAll=function(){this.$context=null,a.each([this.$input,this.$button,this.$dropdown,this.$error_message],function(a,b){b&&b.remove()})},b.prototype.lookupPostcode=function(b){var c=this;return a.idealPostcodes.validatePostcodeFormat(b)?(a.idealPostcodes.lookupPostcode(b,c.api_key,function(a){c.response_code=a.code,c.response_message=a.message,c.result=a.result,c.enableLookup(),2e3===c.response_code?(c.last_lookup=b,c.setDropDown(c.result)):4040===c.response_code?c.setErrorMessage(c.error_message_not_found):c.debug_mode?c.setErrorMessage("("+c.response_code+") "+c.response_message):c.setErrorMessage(c.error_message_default),c.onLookupSuccess&&c.onLookupSuccess(a)},function(){c.setErrorMessage("Unable to connect to server"),c.enableLookup(),c.onLookupError&&c.onLookupError()}),void 0):(this.enableLookup(),c.setErrorMessage(this.error_message_invalid_postcode))},b.prototype.setDropDown=function(b){var c=this;if(this.$dropdown&&this.$dropdown.length&&(this.$dropdown.remove(),delete this.$dropdown),b){var d=a("<select />",{id:c.dropdown_id,"class":c.dropdown_class});a("<option />",{value:"ideal",text:c.dropdown_select_message}).appendTo(d);for(var e=b.length,f=0;e>f;f+=1)a("<option />",{value:f,text:b[f].line_1+" "+b[f].line_2}).appendTo(d);return d.appendTo(c.$context).change(function(){var d=a(this).val();d>=0&&(c.setAddressFields(b[d]),c.onAddressSelected&&c.onAddressSelected.call(this,b[d]))}),c.$dropdown=d,d}},b.prototype.setErrorMessage=function(b){return this.$error_message&&this.$error_message.length&&(this.$error_message.remove(),delete this.$error_message),b?(this.$error_message=a("<p />",{html:b,id:this.error_message_id,"class":this.error_message_class}).appendTo(this.$context),this.$error_message):void 0},b.prototype.setAddressFields=function(a){a=a||{};for(var b in this.$output_fields)this.$output_fields[b].val(a[b]||"")},a.idealPostcodes={defaults:function(){return e},setup:function(a){c=new b(a),d.push(c)},validatePostcodeFormat:function(a){return!!a.match(/^[a-zA-Z0-9]{1,4}\s?\d[a-zA-Z]{2}$/)||!!a.match(/^id1/i)},lookupPostcode:function(b,c,d,f){var g=e.api_endpoint,h="postcodes",i=[g,h,b].join("/"),j={url:i,data:{api_key:c},dataType:"jsonp",timeout:5e3,success:d};f&&(j.error=f),a.ajax(j)},clearAll:function(){for(var a=d.length,b=0;a>b;b+=1)d[b].removeAll()}},a.fn.setupPostcodeLookup=function(e){if(e){var f=new b(e);d.push(f),f.setupPostcodeInput(a(this))}else c.setupPostcodeInput(a(this));return this}}(jQuery);